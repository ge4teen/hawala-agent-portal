{% extends "base_agent.html" %}
{% block content %}

<h2 class="mb-4">
    Completed Transactions
    <span class="badge bg-success">{{ txs|length }}</span>
</h2>

{% if txs %}
<div class="table-responsive">
    <table class="table table-hover">
        <thead class="table-light">
            <tr>
                <th>ID</th>
                <th>Sender</th>
                <th>Receiver</th>
                <th>Amount</th>
                <th>Currency</th>
                <th>Completed At</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for tx in txs %}
            <tr>
                <td>
                    <span class="badge bg-light text-dark font-monospace">
                        {{ tx.transaction_id[:8] }}...
                    </span>
                </td>
                <td>{{ tx.sender_name }}</td>
                <td>{{ tx.receiver_name }}</td>
                <td class="fw-bold">ZAR {{ "%.2f"|format(tx.amount_local) }}</td>
                <td>
                    <span class="badge bg-info">{{ tx.currency_code }}</span>
                </td>
                <td>
                    {% if tx.completed_at %}
                        <small>{{ tx.completed_at|string|truncate(16, True, '') }}</small>
                    {% else %}
                        <small class="text-muted">Not recorded</small>
                    {% endif %}
                </td>
                <td>
                    <a href="{{ url_for('agent.view_transaction', txid=tx.transaction_id) }}"
                       class="btn btn-sm btn-outline-primary">
                        <i class="fas fa-eye"></i> View
                    </a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div class="alert alert-success mt-3">
    <i class="fas fa-check-circle"></i>
    Showing {{ txs|length }} completed transaction(s).
</div>

{% else %}
<div class="text-center py-5">
    <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
    <h4 class="text-muted">No Completed Transactions</h4>
    <p class="text-muted">You haven't completed any transactions yet.</p>
    <a href="{{ url_for('agent.create_transaction') }}" class="btn btn-primary">
        <i class="fas fa-plus"></i> Create New Transaction
    </a>
</div>
{% endif %}

<style>
.font-monospace {
    font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
}
</style>
{% endblock %}